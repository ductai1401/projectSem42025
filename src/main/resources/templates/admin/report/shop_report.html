<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/_layoutAdmin}">

<head>
    <title layout:fragment="title">Qu·∫£n l√Ω b√°o c√°o c·ª≠a h√†ng</title>
    <style>
        .report-section {
            background-color: #f8f9fa;
            padding: 2rem;
            border-radius: 0.75rem;
            border: 1px solid #dee2e6;
            margin: 2rem auto;
            max-width: 100%;
        }
        .report-section .form-label {
            font-weight: 600;
        }
        .report-section .form-control,
        .report-section .form-select {
            border: none;
            border-bottom: 2px solid #0d6efd;
            border-radius: 0;
            background-color: transparent;
            padding-left: 0;
        }
        .report-section .form-control:focus,
        .report-section .form-select:focus {
            box-shadow: none;
            border-color: #0a58ca;
        }
        .report-section table {
            margin-top: 2rem;
        }
        .modal-content {
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        .modal-dialog {
            max-width: 800px;
            margin: 6rem auto; /* tƒÉng margin ƒë·ªÉ tr√°nh tr√†n navbar */
        }
        @media (min-width: 768px) {
            .modal-dialog-centered {
                align-items: center;
            }
        }
        .evidence-preview img,
        .evidence-preview video {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            margin-top: 0.5rem;
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            border-top: none;
        }
        .modal-footer .btn {
            min-width: 120px;
        }
    </style>
</head>

<body>
<div layout:fragment="content">
    <div class="report-section container-fluid">
        <h3 class="mb-4">üìã Danh s√°ch b√°o c√°o c·ª≠a h√†ng</h3>

        <!-- B·ªô l·ªçc t√¨m ki·∫øm -->
        <form class="row row-cols-lg-auto g-3 align-items-end mb-3 justify-content-end" method="get" th:action="@{/admin/reports/shop}">
            <div class="col-md-3">
                <label class="form-label">T·ª´ kh√≥a</label>
                <input type="text" name="keyword" class="form-control" placeholder="T√¨m theo c·ª≠a h√†ng ho·∫∑c n·ªôi dung" th:value="${keyword}">
            </div>
            <div class="col-md-3">
                <label class="form-label">Lo·∫°i b√°o c√°o</label>
                <select name="type" class="form-select">
                    <option value="">-- T·∫•t c·∫£ --</option>
                    <option value="spam">Spam</option>
                    <option value="fraud">Gian l·∫≠n</option>
                    <option value="abuse">H√†nh vi x·∫•u</option>
                    <option value="other">Kh√°c</option>
                </select>
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-primary">üîç L·ªçc</button>
            </div>
        </form>

        <!-- Danh s√°ch b√°o c√°o -->
        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>üõí C·ª≠a h√†ng</th>
                    <th>üìÇ Lo·∫°i b√°o c√°o</th>
                    <th>üìù N·ªôi dung</th>
                    <th>üìÖ Ng√†y g·ª≠i</th>
                    <th>üîß H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody>
              <!--   <tr th:each="report, iterStat : ${reports}">
                    <td th:text="${iterStat.count}">1</td>
                    <td th:text="${report.shopName}">Shop ABC</td>
                    <td th:text="${report.reportType}">Gian l·∫≠n</td>
                    <td th:text="${report.content}">N·ªôi dung chi ti·∫øt...</td>
                    <td th:text="${#dates.format(report.createdAt, 'dd/MM/yyyy')}">10/07/2025</td>
                    <td>
                        <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#reportDetailModal"
                                th:attr="data-shop=${report.shopName}, data-type=${report.reportType}, data-content=${report.content}, data-date=${#dates.format(report.createdAt, 'dd/MM/yyyy')}, data-image=${report.imageEvidence}, data-video=${report.videoEvidence}">üëÅ Xem</button>
                        <a th:href="@{'/admin/reports/shop/delete/' + ${report.id}}" class="btn btn-danger btn-sm">üóë X√≥a</a>
                    </td>
                </tr> -->
              <tr>
        <td>1</td>
        <td>Shop Gi√†y ABC</td>
        <td>Gian l·∫≠n</td>
        <td>Shop y√™u c·∫ßu chuy·ªÉn kho·∫£n tr∆∞·ªõc nh∆∞ng kh√¥ng giao h√†ng.</td>
        <td>10/07/2025</td>
        <td>
            <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#reportDetailModal"
                data-shop="Shop Gi√†y ABC"
                data-type="Gian l·∫≠n"
                data-content="Shop y√™u c·∫ßu chuy·ªÉn kho·∫£n tr∆∞·ªõc nh∆∞ng kh√¥ng giao h√†ng."
                data-date="10/07/2025"
                data-image="/uploads/reports/img/sample.jpg"
                data-video="/uploads/reports/video/sample.mp4">üëÅ Xem</button>
            <a href="#" class="btn btn-danger btn-sm">üóë X√≥a</a>
        </td>
    </tr>
                
                </tbody>
            </table>
        </div>
    </div>
    <!-- Modal xem chi ti·∫øt b√°o c√°o -->
<div class="modal fade" id="reportDetailModal" tabindex="-1" aria-labelledby="reportDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reportDetailModalLabel">Chi ti·∫øt b√°o c√°o</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
            </div>
            <div class="modal-body">
                <p><strong>C·ª≠a h√†ng:</strong> <span id="modalShop"></span></p>
                <p><strong>Lo·∫°i b√°o c√°o:</strong> <span id="modalType"></span></p>
                <p><strong>N·ªôi dung:</strong></p>
                <p id="modalContent"></p>
                <p><strong>Ng√†y g·ª≠i:</strong> <span id="modalDate"></span></p>
                <div class="evidence-preview">
                    <p><strong>Ch·ª©ng c·ª©:</strong></p>
                    <img id="modalImage" style="display:none;" />
                    <video id="modalVideo" style="display:none;" controls></video>
                </div>
                <div class="modal-footer">
                <form th:action="@{/admin/reports/shop/resolve}" method="post">
                    <input type="hidden" name="reportId" id="footerReportId" />
                    <button type="submit" name="action" value="approve" class="btn btn-success">‚úÖ Duy·ªát</button>
                    <button type="submit" name="action" value="reject" class="btn btn-secondary">‚ùå T·ª´ ch·ªëi</button>
                    <button type="submit" name="action" value="warn" class="btn btn-warning">‚ö†Ô∏è C·∫£nh b√°o</button>
                </form>
            </div>
            </div>
        </div>
    </div>
</div>
</div>



<div layout:fragment="scripts">
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const modal = document.getElementById('reportDetailModal');
        if (modal) {
            modal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                document.getElementById('modalShop').textContent = button.getAttribute('data-shop');
                document.getElementById('modalType').textContent = button.getAttribute('data-type');
                document.getElementById('modalContent').textContent = button.getAttribute('data-content');
                document.getElementById('modalDate').textContent = button.getAttribute('data-date');

                const image = document.getElementById('modalImage');
                const video = document.getElementById('modalVideo');
                const imageUrl = button.getAttribute('data-image');
                const videoUrl = button.getAttribute('data-video');

                if (imageUrl) {
                    image.src = imageUrl;
                    image.style.display = 'block';
                } else {
                    image.style.display = 'none';
                }

                if (videoUrl) {
                    video.src = videoUrl;
                    video.style.display = 'block';
                } else {
                    video.style.display = 'none';
                }
            });
        }
    });
</script>
</div>
</body>
</html>
